{% extends "layouts/base.html" %}
{% set site_content_class = 'home-content' %}
{% block full_title %}
  {% if current_user.is_authenticated %}
    Stories - {{ site_name }}
  {% else %}
    {{ site_name }} - A place to digg open source project stories.
  {% endif %}
{% endblock %}
{% block jumbotron %}
{% if not current_user.is_authenticated %}
<div class="jumbotron home-jumbotron">
  <div class="container">
    <h1>The community for modern developers.</h1>
    <p class="lead">Dig interesting stories from open source projects, Share it with other people, Promote community development of open source projects.</p>
    <p class="lead">
      <a class="btn btn-success" href="{{ url_for('users.join') }}" role="button">Sign up</a>
    </p>
  </div>
</div>
{% endif %}
{% endblock %}
{% block content %}
<div class="row">
  <div class="col-12 col-md-3">
    <div class="home-sidebar">
      <div class="d-block d-md-none">
        <button id="home-sidebar-toggler" class="sidebar-toggler sidebar-toggler-right" type="button" data-toggle="collapse" data-target="#home-sidebar-content" aria-controls="home-sidebar-content" aria-expanded="false" aria-label="Toggle navigation">
          <i class="octicon octicon-gear"></i>
        </button>
        {% if sort == 'top' %}
          <span class="label label-sm label-red">
            <i class="octicon octicon-flame"></i>
          </span>
          Top Stories
          {% if current_user.is_authenticated and current_user.following_topics | length > 0 %}
          To Watch
          {% endif %}
        {% else %}
          <span class="label label-sm label-orange">
            <i class="octicon octicon-clock"></i>
          </span>
          Recent Stories
          {% if current_user.is_authenticated and current_user.following_topics | length > 0 %}
          To Watch
          {% endif %}
        {% endif %}
      </div>
      <div class="sidebar-content collapse" id="home-sidebar-content">
        <h3>Feeds</h3>
        <ul class="nav links-gray-dark flex-column">
          <a class="nav-link{{ ' active' if sort == 'top' }}" href="{{ url_for('index') }}">Top Stories</a>
          <a class="nav-link{{ ' active' if sort == 'recent' }}" href="{{ url_for('index', sort='recent') }}">Recent Stories</a>
        </ul>
        {% if sort == 'top' %}
        <div class="d-block d-md-none">
          <h3>Time</h3>
          <nav class="nav links-gray-dark flex-column">
            <a class="nav-link{{ ' active' if timeframe == 'today' }}" href="{{ url_for('index', timeframe='today') }}">Today</a>
            <a class="nav-link{{ ' active' if timeframe == 'week' }}" href="{{ url_for('index', timeframe='week') }}">Week</a>
            <a class="nav-link{{ ' active' if timeframe == 'month' }}" href="{{ url_for('index', timeframe='month') }}">Month</a>
            <a class="nav-link{{ ' active' if timeframe == 'year' }}" href="{{ url_for('index', timeframe='year') }}">Year</a>
          </nav>
        </div>
        {% endif %}
        <h3>Topics</h3>
        {% if current_user.is_authenticated %}
          {% if current_user.following_topics | length > 0 %}
          <ul class="nav links-gray-dark flex-column">
            {% for t in topics %}
            <a href="{{ url_for('index', topic=t.name, sort=sort) }}" class="nav-link{{ ' active' if t.name == topic_name }}">
              {{ t.name }}
            </a>
            {% endfor %}
          </ul>
          {% else %}
          <div class="card mb-3">
            <div class="card-body">
              <p class="card-text">
                You are not following any topic.
              </p>
              <a class="card-link" href="{{ url_for('topics.index') }}">Explore topics</a>
            </div>
          </div>
          {% endif %}
        {% else %}
        <ul class="nav links-gray-dark flex-column">
          {% for t in topics %}
          <a href="{{ url_for('index', topic=t.name, sort=sort) }}" class="nav-link{{ ' active' if t.name == topic_name }}">
            {{ t.name }}
          </a>
          {% endfor %}
          <a href="{{ url_for('topics.index') }}" class="nav-link">More...</a>
        </ul>
        {% endif %}
        <div class="d-none d-md-block">
          <h3>Credits</h3>
          <div class="card">
            <div class="card-body">
              <a href="https://www.vultr.com/?ref=6890184">
                <img src="https://www.vultr.com/media/badge_onwhite.svg">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-9">
    <div class="section-header d-none d-md-block">
      {% if sort == 'top' %}
        <nav class="nav float-right links-muted">
          <a class="nav-link{{ ' active' if timeframe == 'today' }}" href="{{ url_for('index', timeframe='today') }}">Today</a>
          <a class="nav-link{{ ' active' if timeframe == 'week' }}" href="{{ url_for('index', timeframe='week') }}">Week</a>
          <a class="nav-link{{ ' active' if timeframe == 'month' }}" href="{{ url_for('index', timeframe='month') }}">Month</a>
          <a class="nav-link{{ ' active' if timeframe == 'year' }}" href="{{ url_for('index', timeframe='year') }}">Year</a>
        </nav>
        <span class="label label-sm label-red">
          <i class="octicon octicon-flame"></i>
        </span>
        Top Stories
        {% if current_user.is_authenticated and current_user.following_topics | length > 0 %}
        To Watch
        {% endif %}
      {% else %}
        <span class="label label-sm label-orange">
          <i class="octicon octicon-clock"></i>
        </span>
        Recent Stories
        {% if current_user.is_authenticated and current_user.following_topics | length > 0 %}
        To Watch
        {% endif %}
      {% endif %}
    </div>
    <div id="home-feeds" class="feed-list" data-pages="{{ feeds.pages }}">
      {% if topic %}
      <div class="feed-card">
        {% include "components/_topic_feed.html" %}
      </div>
      {% endif %}
      {% if feeds.items | length < 1 %}
      <div class="card">
        <div class="card-body text-center">
          <h1 class="text-muted">
            <i class="octicon octicon-stop"></i>
          </h1>
          <p class="card-text">Oops! there was no story in this timeframe.</p>
        </div>
      </div>
      {% else %}
        {% include "components/_feed_card_list.html" %}
        {% if feeds.has_next %}
        <div id="feeds-loading-tip" class="feed-card">
        {% include "components/_feed_wireframe.html" %}
        </div>
        <p id="feeds-loaded-tip" class="text-muted text-center mt-3" style="display: none">
          <i class="octicon octicon-stop"></i>
          You've reached the end of the list
        </p>
        {% else %}
        <p id="feeds-loaded-tip" class="text-muted text-center mt-3">
          <i class="octicon octicon-stop"></i>
          You've reached the end of the list
        </p>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
